# Outlier Handling

## 🎯 문제상황
동일 sample 내 여러 변수에 이상치가 존재할 수 있으며,  
반복측정 데이터인 경우 이상치 여부를 동일 개체 내 변화 패턴이나 전체 분포를 통해 탐지할 수 있음.

## 🔎 고려사항
- 이상치는 단순 오류일 수도 있지만, 의미 있는 신호일 가능성도 있음  
- 제거보다는 변환 또는 완화(winsorizing, robust scaling 등)가 더 적절할 수 있음  
- 반복측정 데이터의 경우, 시간 흐름 속에서 이상값 판단 가능

---

## 🧠 주요 기법 정리

| 기법 이름                  | 설명                                                   | 종류                                                |
|-------------------------|------------------------------------------------------|---------------------------------------------------|
| **Z-score**              | 평균으로부터 표준편차 기준 몇 배 이상 벗어났는지 확인                        | 통계 기반 스코어링 (보통 |z| > 3 기준)                     |
| **IQR Rule**             | 사분위수를 활용하여 이상값을 판단                             | IQR 범위 벗어난 값 (Q1 - 1.5×IQR, Q3 + 1.5×IQR)     |
| **Winsorizing**          | 극단값을 일정 범위 내 상한/하한으로 절단                         | outlier를 삭제하지 않고 경계값으로 대체                   |
| **Log / Box-Cox Transform** | 분포가 심하게 치우친 변수를 정규성에 가깝게 변환                      | 분산을 줄이고 이상치 영향 완화                         |
| **Robust Scaler**        | 중앙값과 IQR 기준으로 스케일링                               | 표준화 대신 이상치 영향을 줄이는 전처리 방식               |
| **Isolation Forest**     | 트리 구조를 기반으로 이상치를 탐지                            | 비지도 학습 기반 이상치 탐지                           |
| **LOF (Local Outlier Factor)** | 밀도 기반 이상치 탐지 기법                                  | 주변 이웃과의 밀도 차이를 기반으로 판단                  |
| **Time-series Smoothing**| rolling mean, exponential smoothing 등으로 패턴에서 벗어난 점 감지 | 반복측정에서 개체 내 시계열 기반 이상값 탐지 가능          |

---

## 🌲 Outlier Handling Decision Tree

🔍 데이터에 반복측정 구조(동일 ID에 여러 시점)가 있는가?  
│  
├── ✔ Yes (longitudinal)  
│ │  
│ ├── 시계열 순서 정보가 있는가?  
│ │ ├── ✔ Yes  
│ │ │ ├── 값의 변화가 점진적이라고 가정 가능한가?  
│ │ │ │  
│ │ │ ├── ✔ Yes → ✅ [Time-series smoothing], [Z-score by individual]  
│ │ │ └── ✘ No → ⚠ [Robust Scaler], [Group-wise outlier detection]  
│ │ │  
│ │ └── ✘ No → ⚠ Global 기준으로 처리 (전체 분포 기반)  
│ │  
│ └── 이상값이 개체마다 다르게 정의되어야 하나?  
│ └── ✔ Yes → Group-wise 이상치 처리 추천 (예: per ID Z-score)  
│  
└── ✘ No (cross-sectional)  
│  
├── 수치형 변수인가?  
│ ├── ✔ Yes  
│ │ ├── 정규분포 가정 가능? → ✅ [Z-score], [Log Transform]  
│ │ ├── 치우친 분포인가? → ✅ [Box-Cox], [Winsorizing]  
│ │ └── 이상값 비율 많음 → ✅ [Robust Scaler], [IQR]  
│ │  
│ └── ✘ No → 범주형은 이상치 개념보다 "rare category"로 판단  
│  
└── 이상치가 outcome에 영향 미치는가?  
├── ✔ Yes → 민감도 분석 시 이상값 포함/제외 비교  
└── ✘ No → 전체 평균/분산에 영향 주지 않도록 변환 or 완화  

---

## 📌 실무 팁
- 이상값 제거보다는 **Winsorizing 또는 변환**이 더 신중한 접근  
- 이상값 처리 전후 결과 비교 → 민감도 분석 필수  
- 반복측정에서는 **동일 개체 내 패턴**을 기준으로 판단할 수 있음  
- 결측과 이상값은 종종 **같은 원인에서 발생** → 함께 탐지하는 것이 좋음
